<mat-sidenav-container class="editor-container">
  <!-- Collapsible side navigation -->
  <mat-sidenav #sidenav mode="side" opened class="sidenav">
    <mat-toolbar color="primary" class="sidenav-header">
      Explorers
      <span class="spacer"></span>
      <button
        mat-icon-button
        (click)="newFile()"
        matTooltip="New File"
        matTooltipPosition="above"
      >
        <mat-icon>note_add</mat-icon>
      </button>
      <button
        mat-icon-button
        (click)="new_folder()"
        matTooltip="New Folder"
        matTooltipPosition="above"
      >
        <mat-icon>create_new_folder</mat-icon>
      </button>
    </mat-toolbar>

    <!-- File Explorer Tree -->
    <div>
      <nevy11-file-search-bar></nevy11-file-search-bar>
    </div>

    <mat-tree
      #tree
      [dataSource]="dataSource"
      [childrenAccessor]="childrenAccessor"
    >
      <!-- Leaf node template -->
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
        @if (node.isEditing) {
        <button matIconButton>
          <mat-icon>insert_drive_file</mat-icon>
        </button>
        <input
          matInput
          [(ngModel)]="node.name"
          (blur)="finishEditing(node)"
          (keyup.enter)="finishEditing(node)"
          (keyup.escape)="cancelEditing(node)"
          placeholder="Enter file name"
          autofocus
        />
        }

        <!-- Show file name normally -->
        @if (!node.isEditing) {
        <button matIconButton>
          <mat-icon>insert_drive_file</mat-icon>
        </button>
        <span class="node" (click)="openFile(node)" style="cursor: pointer">
          {{ node.name }}
          <button
            mat-icon-button
            (click)="delete_file(node)"
            matTooltip="delete"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </span>
        }
      </mat-tree-node>

      <mat-tree-node
        *matTreeNodeDef="let node; when: hasChild"
        matTreeNodePadding
        matTreeNodeToggle
        [cdkTreeNodeTypeaheadLabel]="node.name"
      >
        @if (node.isEditing) {
        <mat-icon>create_new_folder</mat-icon>
        <input
          matInput
          [(ngModel)]="node.name"
          (blur)="finishEditingFolder(node)"
          (keyup.enter)="finishEditingFolder(node)"
          (keyup.escape)="cancelEditing(node)"
          placeholder="Enter folder name"
          autofocus
        />
        } @else {
        <button
          mat-icon-button
          matTreeNodeToggle
          [attr.aria-label]="'Toggle ' + node.name"
          (click)="onNodeToggle(node, !tree.isExpanded(node))"
        >
          <mat-icon class="mat-icon-rtl-mirror">
            {{ tree.isExpanded(node) ? "expand_more" : "chevron_right" }}
          </mat-icon>
        </button>

        <mat-icon>folder</mat-icon>
        {{ node.name }}
        }
      </mat-tree-node>
    </mat-tree>
  </mat-sidenav>

  <!-- Main editor area -->
  <mat-sidenav-content class="editor-content">
    <mat-toolbar>
      <button
        mat-icon-button
        (click)="sidenav.toggle()"
        class="menu-button"
        matTooltip="minimize menu"
        matTooltipPosition="above"
      >
        <mat-icon>menu</mat-icon>
      </button>
      <span class="spacer"></span>
      monaco editor
    </mat-toolbar>
    @if (isBrowser) {
    <ngx-monaco-editor
      [(ngModel)]="code"
      [options]="editorOptions"
      (onInit)="onEditorInit($event)"
    ></ngx-monaco-editor>
    }

    <div class="btn">
      <button mat-flat-button color="primary" (click)="downloadCode()">
        Download Code
      </button>
      <span class="spacer"></span>
      <button mat-flat-button color="accent" (click)="resetCode()">
        Reset Code
      </button>
      <span class="spacer"></span>
      <button mat-flat-button color="warn" (click)="runCode()">Run Code</button>
    </div>
    <div>
      <nevy11-terminal [logs]="this.logs"></nevy11-terminal>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
